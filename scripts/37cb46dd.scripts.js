"use strict";angular.module("pokerPlanningApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/info",{templateUrl:"views/info.html",controller:"InfoCtrl"}).when("/:roomID",{templateUrl:"views/room.html",controller:"RoomCtrl"})}]),angular.module("pokerPlanningApp").controller("MainCtrl",["$scope","User","$location","$route","Page",function(a,b,c,d,e){e.setDefault();var f=function(){a.nameObj=b.getName(),a.nameObj.$bind(a,"name"),a.roomObj=b.getRoom(),a.roomObj.$bind(a,"room")};b.login().then(function(b){a.uid=b,f()}),a.logout=function(){b.logout(),d.reload()},a.submit=function(){c.path("/"+a.room)}}]),angular.module("pokerPlanningApp").factory("User",["$q","$firebase","$firebaseSimpleLogin","config",function(a,b,c,d){var e,f=c(new Firebase(d.server)),g=function(a){var c=a||f.user.uid;return b(new Firebase(d.server+"users/"+c+"/name"))},h=function(a){var c=a||f.user.uid;return b(new Firebase(d.server+"users/"+c+"/room"))},i=function(){var b=a.defer();return f.$login("anonymous",{rememberMe:!0}).then(function(a){b.resolve(a)}),b.promise},j=function(){var b=a.defer(),c=function(a){e=a.uid,b.resolve(a.uid)};return f.$getCurrentUser().then(function(a){null==a?i().then(function(a){c(a)}):c(a)}),b.promise},k=function(){return f.$logout(),"logout"},l=function(a){return g(a)},m=function(a){return h(a)},n=function(a){m().$set(a)},o=function(){var b=a.defer(),c=l();return c.$on("loaded",function(){b.resolve(!!c.$value)}),b.promise};return{login:function(){return j()},logout:function(){return k()},getUID:function(){return e},getName:function(a){return l(a)},getRoom:function(a){return m(a)},setRoom:function(a){n(a)},hasName:function(){return o()}}}]),angular.module("pokerPlanningApp").controller("RoomCtrl",["$scope","User","Room","$routeParams","config","$location","votesDoneFilter","Page",function(a,b,c,d,e,f,g,h){a.votesDone=g,a.roomID=d.roomID,c.setID(d.roomID),a.roomObj=c.getRoom(),a.names=c.getNames(),a.votes=e.votes,b.login().then(function(e){a.uid=e,c.setUser().then(function(){b.setRoom(d.roomID),b.hasName().then(function(a){a||f.path("/")})})}),a.voteFor=function(d){var e=a.roomObj[b.getUID()].vote==d?-1:d;c.voteFor(e)},a.resetVote=function(){c.resetVote()},a.removeUser=function(a){c.removeUser(a)},h.setTitle(d.roomID)}]),angular.module("pokerPlanningApp").factory("Room",["$q","$firebase","User","config",function(a,b,c,d){var e,f={},g=function(a){var c=a||e;return b(new Firebase(d.server+"/rooms/"+c))},h=function(){var a=g();a.$on("child_added",function(a){var b=c.getName(a.snapshot.name),d=function(){f[a.snapshot.name]=b.$value};b.$on("change",d),b.$on("loaded",d)}),a.$on("child_removed",function(a){var b=c.getName(a.snapshot.name);b.$off("change"),b.$off("loaded")})},i=function(b){var d=a.defer(),e=g(),f=b||c.getUID();return e.$on("loaded",function(){angular.isUndefined(e[f])&&(e[f]={vote:-1},e.$save(f),d.resolve(f))}),d.promise},j=function(a){var b=g();b.$remove(a)},k=function(a){var b=g(),d=c.getUID();return b[d]={vote:a},b.$save(d),d},l=function(){var a=g();a.$on("loaded",function(){var b=a.$getIndex();b.forEach(function(b){a[b].vote=-1}),a.$save()})};return{setID:function(a){e=a,h()},getID:function(){return e},getRoom:function(a){return g(a)},setUser:function(a){return i(a)},removeUser:function(a){j(a)},voteFor:function(a){k(a)},resetVote:function(){l()},getNames:function(){return f}}}]),angular.module("pokerPlanningApp").constant("config",{server:"https://poker-planning.firebaseio.com/",votes:["?","0","1/2","1","2","3","5","8","13","20","40","100"]}),angular.module("pokerPlanningApp").filter("average",["config",function(a){return function(b){var c=-1,d={},e=-1,f=b.$getIndex();return f.forEach(function(a){var f=b[a];if(f&&f.vote>-1){var g=d[f.vote];d[f.vote]=g?g+1:1;var h=d[f.vote];(h>e||h==e&&f.vote>c)&&(e=h,c=f.vote)}}),a.votes[c]}}]),angular.module("pokerPlanningApp").filter("votesDone",function(){return function(a){var b=!0;return angular.forEach(a,function(a){b=a.vote<0?!1:b}),b}}),angular.module("pokerPlanningApp").controller("PageCtrl",["$scope","Page",function(a,b){a.Page=b}]),angular.module("pokerPlanningApp").controller("PageCtrl",["$scope","Page",function(a,b){a.Page=b}]),angular.module("pokerPlanningApp").factory("Page",function(){var a="Poker planning",b=a;return{title:function(){return b},setTitle:function(a){b=a},setDefault:function(){b=a}}}),angular.module("pokerPlanningApp").controller("InfoCtrl",["$scope",function(){}]);